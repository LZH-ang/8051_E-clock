C51 COMPILER V9.60.0.0   KEY                                                               06/20/2022 13:51:06 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: D:\KEILC51u5\C51\BIN\C51.EXE key.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\key
                    -.lst) TABS(2) OBJECT(.\Objects\key.obj)

line level    source

   1          #include "key.h"
   2          #include "intrins.h"
   3          #include "delay.h"
   4          #include "3231.h"
   5          
   6          u8 mode=0,dis_format=0,temp=1;  //显示界面控制
   7          u8 hour_t,min_t,sec_t,mon_t,day_t,year_t,week_t;  //临时存数据
   8          bit dis_time=0,dis_temp=0;  //月日温度显示控制
   9          bit or_wr=0;  //判断设置界面是否有时间改动操作
  10          bit or_hour=0,or_min=0,or_mon=0,or_day=0; //判断设置界面时分月日是否有改动操作
  11          
  12          void Key_Set()
  13          {
  14   1        if(SW1 == 0)
  15   1        {
  16   2          Delay10ms();
  17   2          if(SW1 == 0)  //正常&设置界面切换
  18   2          {
  19   3            mode = 1;
  20   3            dis_format++;
  21   3            if(dis_format >= 5)
  22   3            {
  23   4              dis_format = 0;
  24   4              mode = 0;
  25   4              temp = 1;
  26   4              or_wr=0;
  27   4              or_hour=0;
  28   4              or_min=0;
  29   4              or_mon=0;
  30   4              or_day=0;
  31   4            }
  32   3          }
  33   2          Delay10ms();
  34   2          while(!SW1);  
  35   2        }
  36   1      }
  37          
  38          void Key_Change()
  39          {
  40   1        if(SW2 == 0)
  41   1        {
  42   2          Delay10ms();
  43   2          if(SW2 == 0)
  44   2          {
  45   3            if(mode == 0) //时分&月日显示切换
  46   3            {
  47   4              dis_time = ~dis_time;
  48   4            }
  49   3            if(mode == 1) //设置时间
  50   3            {
  51   4              if(dis_format == 1){hour_t++;if(hour_t >= 24)hour_t = 0;or_wr = 1;or_hour = 1;}
  52   4              if(dis_format == 2){min_t++;if(min_t >= 60)min_t = 0;or_wr = 1;or_min = 1;}
  53   4              if(dis_format == 3){mon_t++;if(mon_t >= 13)mon_t = 1;or_wr = 1;or_mon = 1;}
  54   4              if(dis_format == 4){day_t++;if(day_t >= 32)day_t = 1;or_wr = 1;or_day = 1;}
C51 COMPILER V9.60.0.0   KEY                                                               06/20/2022 13:51:06 PAGE 2   

  55   4            }
  56   3          }
  57   2          Delay10ms();
  58   2          while(!SW2);
  59   2        } 
  60   1      }
  61          
  62          void Key_Enter()
  63          {
  64   1        if(SW3 == 0)
  65   1        {
  66   2          Delay10ms();
  67   2          if(SW3 == 0)
  68   2          {
  69   3            if(mode == 0)
  70   3            {
  71   4              dis_temp = ~dis_temp;
  72   4            }
  73   3            if(mode == 1)
  74   3            {
  75   4              if(or_wr == 0)//无操作就退出
  76   4              {
  77   5                mode = 0;
  78   5                dis_format=0;
  79   5                temp = 1;     
  80   5              }
  81   4              else if((or_wr == 1)&&(mode == 1))//有操作就写入时间
  82   4              {
  83   5                if(or_hour){ModifyTime(DS3231_HOUR,hour_t);or_wr = 0;or_hour = 0;}
  84   5                if(or_min){ModifyTime(DS3231_MINUTE,min_t);_nop_();ModifyTime(DS3231_SECOND,30);or_wr = 0;or_min = 0;
             -}
  85   5                if(or_mon){ModifyTime(DS3231_MONTH,mon_t);or_wr = 0;or_mon = 0;}
  86   5                if(or_day){ModifyTime(DS3231_DAY,day_t);or_wr = 0;or_day = 0;}        
  87   5              }
  88   4            }     
  89   3          }
  90   2          Delay10ms();
  91   2          while(!SW3);
  92   2        } 
  93   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    306    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     10    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      7    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
